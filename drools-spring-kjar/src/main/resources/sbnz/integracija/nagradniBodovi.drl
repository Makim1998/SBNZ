package sbnz.integracija;

import com.example.model.Klijent;
import com.example.model.Kredit;
import com.example.model.ZahtevKredit;
import com.example.model.TipGarancije;
import com.example.model.TipKredita;

import java.util.List;

declare Score
	percentConditions: double;
	numPoints: int;
end


rule "1 nagradni poen" 
    agenda-group "nagradniBod"
    when
        $zahtev: ZahtevKredit($suma: iznos, $klijent: klijent)
       	$prviUslov: Number(intValue >= 0) from accumulate(
       		ZahtevKredit(iznos >= 10000),
       		init(int count = 0;),
       		action(count = 1;),
       		result(count)
       	)
       	$drugiUslov: Number(intValue >= 0) from accumulate(
        	Kredit($t: this) from $klijent.getKrediti(),
        	init(int count = 0;),
       		action(count = 1;),
       		result(count)
        )
       	$treciUslov: Number(intValue >= 0) from accumulate(
       		ZahtevKredit(tipGarancije ==  TipGarancije.HIPOTEKA),
       		init(int count = 0;),
       		action(count = 1;),
       		result(count)
       	)
    then
    	int brojUslova = 3; 
    	int brojIspunjenih = $prviUslov.intValue() + $drugiUslov.intValue() + $treciUslov.intValue();
    	int poeni = 1;
    	Score score = new Score();
    	score.setPercentConditions(brojIspunjenih / 3.0);
    	score.setNumPoints(1);
        insert(score);
end
